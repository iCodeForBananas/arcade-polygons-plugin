"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o};Phaser.Plugin.ArcadePolygons=function(o,t){Phaser.Plugin.call(this,o,t),this.facade=new Phaser.Plugin.ArcadePolygons.Facade},Phaser.Plugin.ArcadePolygons.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.ArcadePolygons.prototype.constructor=Phaser.Plugin.ArcadePolygons,Phaser.Plugin.ArcadePolygons.VERSION="1",Phaser.Plugin.ArcadePolygons.prototype.init=function(){this.game.arcadePolygons=this.game.arcadePolygons||this.facade,this.originalCollideSpriteVsGroup=Phaser.Physics.Arcade.prototype.collideSpriteVsGroup,Phaser.Physics.Arcade.prototype.collideSpriteVsGroup=Phaser.Plugin.ArcadePolygons.Overrides.collideSpriteVsGroup},Phaser.Plugin.ArcadePolygons.prototype.destroy=function(){this.game.arcadePolygons=null,Phaser.Physics.Arcade.prototype.collideSpriteVsGroup=this.originalCollideSpriteVsGroup,Phaser.Plugin.prototype.destroy.call(this)},Phaser.Plugin.ArcadePolygons.Facade=function(){},Phaser.Plugin.ArcadePolygons.Facade.prototype.enable=function(o,t){if(Array.isArray(o))for(var e=0;e<o.length;e++)this.enable(o[e]);else o instanceof Phaser.Group?this.enable(o.children):(o.hasOwnProperty("body")&&this.enableBody(o.body,t),o.hasOwnProperty("children")&&o.children.length>0&&this.enable(o.children))},Phaser.Plugin.ArcadePolygons.Facade.prototype.enableBody=function(o,t){for(var e=[],r=0;r<t.length;r+=2)e.push(new SAT.Vector(t[r],t[r+1]));var n=new SAT.Polygon(new SAT.Vector(0,0),e);o.sat={polygon:n}},Phaser.Plugin.ArcadePolygons.Facade.prototype.enableSpriteBody=function(o){o.hasOwnProperty("body")||console.error("Enable arcade physics before enabling polygon physics.");var t=o.body,e=new SAT.Box(new SAT.Vector(t.x,t.y),t.width,t.height).toPolygon();t.sat={polygon:e}},Phaser.Plugin.ArcadePolygons.Facade.prototype.enableGroup=function(o,t,e){t.forEach(function(t){var r=e.game.add.sprite(0,0);e.game.physics.arcade.enable(r),e.game.arcadePolygons.enable(r,t),r.body.immovable=!0,r.body.allowGravity=!1,o.add(r)})},Phaser.Plugin.ArcadePolygons.Overrides={},Phaser.Plugin.ArcadePolygons.Overrides.collideSpriteVsGroup=function(o,t,e,r,n,s){if(!o.body)return!1;o.body.sat||console.error("Non polygon object!"),this.debug={vectors:[],normals:[]},this.features={debug:0,speed:1e3,bounce:0,gravity:500,friction:0,slowMotion:1};var i=o.body;i.sat.polygon.pos.x=i.x,i.sat.polygon.pos.y=i.y;for(var p in t.children){var a=t.children[p],l=new SAT.Response,c=SAT.testPolygonPolygon(i.sat.polygon,a.body.sat.polygon,l);if(c){var h=l.overlapV.clone().scale(-1);i.position.x+=h.x,i.position.y+=h.y,i.sat.polygon.pos.x=i.position.x,i.sat.polygon.pos.y=i.position.y;var y=new SAT.Vector(i.velocity.x,i.velocity.y),u=l.overlapN.clone().scale(-1),f=y.clone().projectN(u),g=y.clone().sub(f),d=f.clone().scale(-this.features.bounce),v=g.clone().scale(1-this.features.friction),P=v.clone().add(d);i.velocity.x=P.x,i.velocity.y=P.y,this.features.debug&&(y.name="velocity",h.name="overlapV",u.name="overlapN",f.name="velocityN",g.name="velocityT",d.name="bounce",v.name="friction",P.name="newVelocity",this.debug.vectors.push(y,u,f,g,d,v,P),this.features.debug>1&&(u.colour="#333",d.colour="#25f",v.colour="#f55",P.colour="#5f5",u.scale(50),this.debug.normals.push(u,d,v,P)))}}}(function(o,t){"function"==typeof define&&define.amd?define(t):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():o.SAT=t()}(void 0,function(){function o(o,t){this.x=o||0,this.y=t||0}function t(t,e){this.pos=t||new o,this.r=e||0}function e(t,e){this.pos=t||new o,this.angle=0,this.offset=new o,this.setPoints(e||[])}function r(t,e,r){this.pos=t||new o,this.w=e||0,this.h=r||0}function n(){this.a=null,this.b=null,this.overlapN=new o,this.overlapV=new o,this.clear()}function s(o,t,e){for(var r=Number.MAX_VALUE,n=-Number.MAX_VALUE,s=o.length,i=0;i<s;i++){var p=o[i].dot(t);p<r&&(r=p),p>n&&(n=p)}e[0]=r,e[1]=n}function i(o,t,e,r,n,i){var p=v.pop(),a=v.pop(),l=g.pop().copy(t).sub(o),c=l.dot(n);if(s(e,n,p),s(r,n,a),a[0]+=c,a[1]+=c,p[0]>a[1]||a[0]>p[1])return g.push(l),v.push(p),v.push(a),!0;if(i){var h=0;if(p[0]<a[0])if(i.aInB=!1,p[1]<a[1])h=p[1]-a[0],i.bInA=!1;else{var y=p[1]-a[0],u=a[1]-p[0];h=y<u?y:-u}else if(i.bInA=!1,p[1]>a[1])h=p[0]-a[1],i.aInB=!1;else{var y=p[1]-a[0],u=a[1]-p[0];h=y<u?y:-u}var f=Math.abs(h);f<i.overlap&&(i.overlap=f,i.overlapN.copy(n),h<0&&i.overlapN.reverse())}return g.push(l),v.push(p),v.push(a),!1}function p(o,t){var e=o.len2(),r=t.dot(o);return r<0?A:r>e?m:x}function a(o,t){var e=g.pop().copy(o).sub(t.pos),r=t.r*t.r,n=e.len2();return g.push(e),n<=r}function l(o,t){b.pos.copy(o),P.clear();var e=u(b,t,P);return e&&(e=P.aInB),e}function c(o,t,e){var r=g.pop().copy(t.pos).sub(o.pos),n=o.r+t.r,s=n*n,i=r.len2();if(i>s)return g.push(r),!1;if(e){var p=Math.sqrt(i);e.a=o,e.b=t,e.overlap=n-p,e.overlapN.copy(r.normalize()),e.overlapV.copy(r).scale(e.overlap),e.aInB=o.r<=t.r&&p<=t.r-o.r,e.bInA=t.r<=o.r&&p<=o.r-t.r}return g.push(r),!0}function h(o,t,e){for(var r=g.pop().copy(t.pos).sub(o.pos),n=t.r,s=n*n,i=o.calcPoints,a=i.length,l=g.pop(),c=g.pop(),h=0;h<a;h++){var y=h===a-1?0:h+1,u=0===h?a-1:h-1,f=0,d=null;l.copy(o.edges[h]),c.copy(r).sub(i[h]),e&&c.len2()>s&&(e.aInB=!1);var v=p(l,c);if(v===A){l.copy(o.edges[u]);var P=g.pop().copy(r).sub(i[u]);if(v=p(l,P),v===m){var b=c.len();if(b>n)return g.push(r),g.push(l),g.push(c),g.push(P),!1;e&&(e.bInA=!1,d=c.normalize(),f=n-b)}g.push(P)}else if(v===m){if(l.copy(o.edges[y]),c.copy(r).sub(i[y]),v=p(l,c),v===A){var b=c.len();if(b>n)return g.push(r),g.push(l),g.push(c),!1;e&&(e.bInA=!1,d=c.normalize(),f=n-b)}}else{var x=l.perp().normalize(),b=c.dot(x),w=Math.abs(b);if(b>0&&w>n)return g.push(r),g.push(x),g.push(c),!1;e&&(d=x,f=n-b,(b>=0||f<2*n)&&(e.bInA=!1))}d&&e&&Math.abs(f)<Math.abs(e.overlap)&&(e.overlap=f,e.overlapN.copy(d))}return e&&(e.a=o,e.b=t,e.overlapV.copy(e.overlapN).scale(e.overlap)),g.push(r),g.push(l),g.push(c),!0}function y(o,t,e){var r=h(t,o,e);if(r&&e){var n=e.a,s=e.aInB;e.overlapN.reverse(),e.overlapV.reverse(),e.a=e.b,e.b=n,e.aInB=e.bInA,e.bInA=s}return r}function u(o,t,e){for(var r=o.calcPoints,n=r.length,s=t.calcPoints,p=s.length,a=0;a<n;a++)if(i(o.pos,t.pos,r,s,o.normals[a],e))return!1;for(var a=0;a<p;a++)if(i(o.pos,t.pos,r,s,t.normals[a],e))return!1;return e&&(e.a=o,e.b=t,e.overlapV.copy(e.overlapN).scale(e.overlap)),!0}var f={};f.Vector=o,f.V=o,o.prototype.copy=o.prototype.copy=function(o){return this.x=o.x,this.y=o.y,this},o.prototype.clone=o.prototype.clone=function(){return new o(this.x,this.y)},o.prototype.perp=o.prototype.perp=function(){var o=this.x;return this.x=this.y,this.y=-o,this},o.prototype.rotate=o.prototype.rotate=function(o){var t=this.x,e=this.y;return this.x=t*Math.cos(o)-e*Math.sin(o),this.y=t*Math.sin(o)+e*Math.cos(o),this},o.prototype.reverse=o.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this},o.prototype.normalize=o.prototype.normalize=function(){var o=this.len();return o>0&&(this.x=this.x/o,this.y=this.y/o),this},o.prototype.add=o.prototype.add=function(o){return this.x+=o.x,this.y+=o.y,this},o.prototype.sub=o.prototype.sub=function(o){return this.x-=o.x,this.y-=o.y,this},o.prototype.scale=o.prototype.scale=function(o,t){return this.x*=o,this.y*=t||o,this},o.prototype.project=o.prototype.project=function(o){var t=this.dot(o)/o.len2();return this.x=t*o.x,this.y=t*o.y,this},o.prototype.projectN=o.prototype.projectN=function(o){var t=this.dot(o);return this.x=t*o.x,this.y=t*o.y,this},o.prototype.reflect=o.prototype.reflect=function(o){var t=this.x,e=this.y;return this.project(o).scale(2),this.x-=t,this.y-=e,this},o.prototype.reflectN=o.prototype.reflectN=function(o){var t=this.x,e=this.y;return this.projectN(o).scale(2),this.x-=t,this.y-=e,this},o.prototype.dot=o.prototype.dot=function(o){return this.x*o.x+this.y*o.y},o.prototype.len2=o.prototype.len2=function(){return this.dot(this)},o.prototype.len=o.prototype.len=function(){return Math.sqrt(this.len2())},f.Circle=t,t.prototype.getAABB=t.prototype.getAABB=function(){var t=this.r,e=this.pos.clone().sub(new o(t,t));return new r(e,2*t,2*t).toPolygon()},f.Polygon=e,e.prototype.setPoints=e.prototype.setPoints=function(t){var e=!this.points||this.points.length!==t.length;if(e){var r,n=this.calcPoints=[],s=this.edges=[],i=this.normals=[];for(r=0;r<t.length;r++)n.push(new o),s.push(new o),i.push(new o)}return this.points=t,this._recalc(),this},e.prototype.setAngle=e.prototype.setAngle=function(o){return this.angle=o,this._recalc(),this},e.prototype.setOffset=e.prototype.setOffset=function(o){return this.offset=o,this._recalc(),this},e.prototype.rotate=e.prototype.rotate=function(o){for(var t=this.points,e=t.length,r=0;r<e;r++)t[r].rotate(o);return this._recalc(),this},e.prototype.translate=e.prototype.translate=function(o,t){for(var e=this.points,r=e.length,n=0;n<r;n++)e[n].x+=o,e[n].y+=t;return this._recalc(),this},e.prototype._recalc=function(){var o,t=this.calcPoints,e=this.edges,r=this.normals,n=this.points,s=this.offset,i=this.angle,p=n.length;for(o=0;o<p;o++){var a=t[o].copy(n[o]);a.x+=s.x,a.y+=s.y,0!==i&&a.rotate(i)}for(o=0;o<p;o++){var l=t[o],c=o<p-1?t[o+1]:t[0],h=e[o].copy(c).sub(l);r[o].copy(h).perp().normalize()}return this},e.prototype.getAABB=e.prototype.getAABB=function(){for(var t=this.calcPoints,e=t.length,n=t[0].x,s=t[0].y,i=t[0].x,p=t[0].y,a=1;a<e;a++){var l=t[a];l.x<n?n=l.x:l.x>i&&(i=l.x),l.y<s?s=l.y:l.y>p&&(p=l.y)}return new r(this.pos.clone().add(new o(n,s)),i-n,p-s).toPolygon()},f.Box=r,r.prototype.toPolygon=r.prototype.toPolygon=function(){var t=this.pos,r=this.w,n=this.h;return new e(new o(t.x,t.y),[new o,new o(r,0),new o(r,n),new o(0,n)])},f.Response=n,n.prototype.clear=n.prototype.clear=function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this};for(var g=[],d=0;d<10;d++)g.push(new o);for(var v=[],d=0;d<5;d++)v.push([]);var P=new n,b=new r(new o,1e-6,1e-6).toPolygon();f.isSeparatingAxis=i;var A=-1,x=0,m=1;return f.pointInCircle=a,f.pointInPolygon=l,f.testCircleCircle=c,f.testPolygonCircle=h,f.testCirclePolygon=y,f.testPolygonPolygon=u,f}));